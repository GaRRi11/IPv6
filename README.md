# IPv6
## Device -> Website

1. Laptop creates LLA → DAD
2. RS → Router
3. RA → Prefix, DNS, SLAAC, Gateway
4. Laptop creates GUA → DAD
5. NDP: Laptop learns router MAC
6. DNS query (via router)
7. DNS reply with IPv4+IPv6
8. Happy Eyeballs → IPv6 chosen
9. TCP SYN → router → website
10. Website SYN/ACK → router → laptop (NDP if needed)
11. TCP handshake complete
12. TLS handshake
13. Encrypted HTTPS traffic begins
## IPv6 Address Structure & Rules

Basic Format

IPv6 has 8 blocks, each block has 4 digits which may contain alphabets and numbers.

Zero Compression Rules

Leading zeros in a block can be removed.
Example:
2001:0db8:85a3:0000:0000:8a2e:0370:7334 →
2001:db8:85a3:0:0:8a2e:370:7334

A full zero block can be replaced with ::

You can ONLY use :: one time in an address.

:: means “one or more blocks of zeros”

Example:
2001:0db8:85a3:0000:0000:8a2e:0370:7334 →
2001:db8:85a3::8a2e:370:7334


## Prefix Length

99% of IPv6 uses /64

First 64 bits = network prefix

Last 64 bits = Interface ID

## IPv6 Address Types

### Global Unicast Address (GUA)

IPv6 version of public WAN IP.

Starts with: 2000::/3 (Any address starting with 2xxx or 3xxx)

Example: 2a02:8440:715c:4cdf:c0a6:459f:0ddc:f5c1

First 4 blocks = provided by ISP

Last 4 blocks = Interface ID (Random blocks generated by device, changed periodically)

After connecting the network router will give prefix via RA which ISP uses then device will add its own IID and craft full GUA IPv6. DAD check it and assign to itself.
GUA always made with prefix from router RA, so if device has GUA means network supports IPv6.

### Link-Local Address (LLA)

Created the moment device connects to network. DAD check it and assign to itself.

Always starts with prefix: fe80::/10

Last 4 blocks generated based on device MAC, or just fixed stable blocks.

Used for Local communication

Format: fe80:xxxx:xxxx:xxxx:…

### Unique Local Address (ULA)

ULA is not automatic and only used when:

A network intentionally assigns ULAs

Multi-segment LAN communication is required

Internal-only servers or services must be reachable

IPv6 DNS is desired

## Default Gateway in IPv6

When device receives RS from router, routers LLA IPv6 is used as IPv6 gateway.
If RA missing → no IPv6 routing at all.


## Duplicate Address Detection (DAD)

“Is anyone using the address? If yes, tell me your MAC.”
If no response then that IPv6 is free to use, and device assigns it to itself.

## Multicast

IPv6 uses multicast instead of broadcast.

Common multicast groups:

ff02::1 — all nodes

ff02::2 — all routers - Devices sends RS to that Destination to discover routers.

ff02::1:ffXX:XXXX — solicited-node (used by NDP)

ff02::1:2 — DHCPv6 servers

IPv6 also supports anycast.
Example: 2001:db8:100::53

## Neighbor Discovery Protocol (NDP)

NDP involves: NS-NA, RS-RS.

NS – what MAC does this IPv6 user have?

NA – response of NS (MAC)

RS – discovering router in network

RA – response of RS:

network prefix
SLAAC allowed or not
DHCPv6 needed or not
DNS (optional)
Router lifetime: 1800 sec (means “use me as your gateway”)

If SLAAC allowed:
device dont need DHCPv6 to get GUA IPv6. device will craft address itself by adding routers provided prefix and its own randomized IID, DAD check it and assigned to itself.

If SLAAC not allowed:
then DHCPv6 must be enabled so managed mode will handle IPv6 assignments to devices.


## IPv6 Packet Structure

| Field       | Purpose                      |
| ----------- | ---------------------------- |
| Source      | Who sent the packet          |
| Destination | Who receives it              |
| Hop Limit   | Prevent infinite loops       |
| Next Header | TCP/UDP/ICMPv6               |
| Flow Label  | Group packets from same flow |



## If Router Does Not Support IPv6

Works:

LLA

Does NOT work:

❌ GUA

❌ ULA

❌ DNS via IPv6

❌ Default gateway

No RA → no IPv6 routing.

## DHCPv6

| Feature            | SLAAC      | Stateful DHCPv6 | Stateless DHCPv6  |
| ------------------ | ---------- | --------------- | ----------------- |
| IPv6 address       | ✔ Yes      | ✔ Yes           | ✔ Yes (via SLAAC) |
| DNS                | ✔ Maybe    | ✔ Yes           | ✔ Yes             |
| Gateway            | ✔ Yes (RA) | ✔ Yes (RA)      | ✔ Yes (RA)        |
| Full admin control | ✖ No       | ✔ Yes           | ✖ No              |

DHCPv6 cannot give default gateway.


